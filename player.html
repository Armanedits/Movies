<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Loading Movie...</title>
    <!-- === CSS (Koi Change Nahi) === -->
    <style>
        :root { --theme-color: #e74c3c; --dark-bg: #121212; --light-bg: #1f1f1f; --card-text-bg: #0c0c0c; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif; background-color: var(--dark-bg); color: #fff; margin: 0; }
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        a { color: inherit; text-decoration: none; }
        
        /* Navigation Bar CSS */
        header { background-color: var(--dark-bg); padding: 10px; position: sticky; top: 0; z-index: 1000; border-bottom: 1px solid #2a2a2a; }
        .nav-bar { display: flex; justify-content: space-between; align-items: center; max-width: 1200px; margin: 0 auto; height: 50px; }
        .nav-left, .nav-right, .logo-container { flex: 1; }
        .logo-container { text-align: center; display: flex; align-items: center; justify-content: center; height: 100%; }
        .logo-container a { display: inline-block; line-height: 0; }
        .nav-right { text-align: right; }
        header img.logo { max-width: 120px; vertical-align: middle; }
        .icon-btn { background: none; border: none; color: white; font-size: 24px; cursor: pointer; padding: 5px; }
        #search-container { display: none; flex-grow: 1; position: relative; }
        #searchInput { width: 100%; height: 40px; padding: 0 45px 0 15px; border-radius: 8px; border: 1px solid var(--theme-color); font-size: 16px; background-color: var(--light-bg); color: #fff; box-sizing: border-box; }
        #close-search-btn { position: absolute; right: 5px; top: 50%; transform: translateY(-50%); font-size: 28px; }
        .nav-bar.search-active .logo-container, .nav-bar.search-active .nav-left, .nav-bar.search-active .nav-right { display: none; }
        .nav-bar.search-active #search-container { display: flex; align-items: center; }
        
        #side-menu { position: fixed; top: 0; left: 0; height: 100%; width: 280px; background-color: #181818; z-index: 1002; transform: translateX(-100%); transition: transform 0.3s ease-in-out; padding-top: 60px; box-shadow: 5px 0 15px rgba(0,0,0,0.5); }
        #side-menu.open { transform: translateX(0); }
        #side-menu .category-item { display: block; color: #fff; padding: 15px 25px; font-size: 18px; border-bottom: 1px solid #2a2a2a; }
        #side-menu .category-item:hover { background-color: var(--theme-color); }
        #menu-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.7); z-index: 1001; display: none; }

        /* Page Content CSS */
        .movie-info-container { display: flex; flex-direction: column; gap: 30px; margin-top: 30px; }
        @media (min-width: 768px) { .movie-info-container { flex-direction: row; } }
        .movie-poster-large { width: 100%; max-width: 250px; height: auto; object-fit: cover; border-radius: 8px; align-self: center; }
        .movie-text-details { flex-grow: 1; }
        #movie-title { font-size: 32px; margin: 0 0 15px 0; }
        #movie-description { font-size: 16px; color: #ccc; line-height: 1.6; }
        h2.section-title { font-size: 22px; margin-top: 30px; border-bottom: 2px solid var(--theme-color); padding-bottom: 10px; }
        .cast-list { display: flex; flex-wrap: wrap; gap: 10px; padding: 0; margin-top: 15px; }
        .cast-member { background-color: var(--light-bg); padding: 8px 15px; border-radius: 20px; font-size: 14px; }
        .download-links { display: flex; flex-wrap: wrap; gap: 15px; margin-top: 20px; }
        .download-btn { background-color: var(--theme-color); color: white; padding: 12px 25px; border-radius: 5px; font-size: 16px; font-weight: bold; display: inline-flex; align-items: center; gap: 10px; transition: background-color 0.2s; cursor: pointer; }
        .download-btn:hover { background-color: #c0392b; }
        .download-btn svg { width: 20px; height: 20px; fill: white; }

        /* Movie Grid (Related + Search Results) */
        .movie-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(80px, 1fr)); gap: 12px; margin-top: 20px; }
        .movie-card { cursor: pointer; transition: transform 0.2s ease; }
        .movie-card:hover { transform: scale(1.05); }
        .movie-card img { width: 100%; height: auto; display: block; border-radius: 6px; aspect-ratio: 2/3; object-fit: cover; }
        .movie-info h3 { font-size: 14px; font-weight: 500; margin: 8px 0 0 0; line-height: 1.3; }

        /* Popup CSS */
        .popup-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.7); display: none; justify-content: center; align-items: center; z-index: 2000; }
        .popup-box { background-color: var(--light-bg); padding: 25px; border-radius: 8px; width: 90%; max-width: 400px; text-align: center; box-shadow: 0 5px 15px rgba(0,0,0,0.5); border-top: 4px solid var(--theme-color); }
        .popup-header h3 { margin: 0 0 15px 0; font-size: 20px; color: #fff; }
        .popup-body p { margin: 0 0 25px 0; font-size: 16px; color: #ccc; }
        .popup-btn { background-color: var(--theme-color); color: white; border: none; padding: 10px 30px; border-radius: 5px; font-size: 16px; font-weight: bold; cursor: pointer; transition: background-color 0.2s; }
        .popup-btn:hover { background-color: #c0392b; }
    </style>
</head>
<body>
    <header>
        <nav class="nav-bar">
            <div class="nav-left"><button class="icon-btn" id="menu-btn">&#9776;</button></div>
            <div class="logo-container"><a href="index.html"><img src="https://raw.githubusercontent.com/Armanedits/Movies/refs/heads/main/Picsart_25-10-11_05-15-44-256.jpg" alt="Logo" class="logo"></a></div>
            <div class="nav-right"><button class="icon-btn" id="search-icon-btn">&#128269;</button></div>
            <div id="search-container"><input type="text" id="searchInput" placeholder="Search for movies..."><button class="icon-btn" id="close-search-btn">&times;</button></div>
        </nav>
    </header>

    <div id="side-menu"></div>
    <div id="menu-overlay"></div>
    
    <main class="container">
        <div id="movie-details-view">
            <div class="movie-info-container">
                <img src="" alt="Movie Poster" id="main-poster" class="movie-poster-large">
                <div class="movie-text-details">
                    <h1 id="movie-title">Loading...</h1>
                    <p id="movie-description"></p>
                    <h2 class="section-title" id="cast-title">Cast</h2>
                    <div id="cast-list" class="cast-list"></div>
                    <h2 class="section-title">Download Links</h2>
                    <div id="download-links" class="download-links"></div>
                </div>
            </div>
            <div class="related-movies">
                <h2 class="section-title">You might also like</h2>
                <div id="related-movies-grid" class="movie-grid"></div>
            </div>
        </div>

        <div id="search-results-view" style="display: none;">
            <h2 id="search-results-title"></h2>
            <div id="search-results-grid" class="movie-grid"></div>
        </div>
    </main>

    <div id="custom-popup" class="popup-overlay">
        <div class="popup-box">
            <div class="popup-header"><h3>Ultimate Movie Site</h3></div>
            <div class="popup-body"><p id="popup-message"></p></div>
            <div class="popup-footer"><button id="popup-close-btn" class="popup-btn">OK</button></div>
        </div>
    </div>

    <!-- === JAVASCRIPT LOGIC (Major Update) === -->
    <script>
    document.addEventListener('DOMContentLoaded', () => {

        let allMovies = []; 

        const movieDetailsView = document.getElementById('movie-details-view');
        const searchResultsView = document.getElementById('search-results-view');
        const searchResultsTitle = document.getElementById('search-results-title');
        const searchResultsGrid = document.getElementById('search-results-grid');

        const popup = document.getElementById('custom-popup');
        const popupMessage = document.getElementById('popup-message');
        const popupCloseBtn = document.getElementById('popup-close-btn');
        function showCustomPopup(message) { popupMessage.textContent = message; popup.style.display = 'flex'; }
        function hideCustomPopup() { popup.style.display = 'none'; }
        popupCloseBtn.addEventListener('click', hideCustomPopup);
        popup.addEventListener('click', (event) => { if (event.target === popup) { hideCustomPopup(); } });

        const sideMenu = document.getElementById('side-menu');
        const menuBtn = document.getElementById('menu-btn');
        const overlay = document.getElementById('menu-overlay');
        const searchIconBtn = document.getElementById('search-icon-btn');
        const closeSearchBtn = document.getElementById('close-search-btn');
        const navBar = document.querySelector('.nav-bar');
        const searchInput = document.getElementById('searchInput');

        menuBtn.addEventListener('click', () => { sideMenu.classList.add('open'); overlay.style.display = 'block'; });
        overlay.addEventListener('click', () => { sideMenu.classList.remove('open'); overlay.style.display = 'none'; });
        searchIconBtn.addEventListener('click', () => navBar.classList.add('search-active'));
        
        closeSearchBtn.addEventListener('click', () => {
            navBar.classList.remove('search-active');
            searchInput.value = '';
            showDetailsView();
        });
        
        searchInput.addEventListener('input', (e) => {
            const term = e.target.value.toLowerCase().trim();
            if (term) {
                showSearchView();
                const filteredMovies = allMovies.filter(m => m.title.toLowerCase().includes(term));
                searchResultsTitle.textContent = `Results for "${term}"`;
                displayMovies(filteredMovies, searchResultsGrid);
            } else {
                showDetailsView();
            }
        });

        function showDetailsView() {
            searchResultsView.style.display = 'none';
            movieDetailsView.style.display = 'block';
        }
        function showSearchView() {
            movieDetailsView.style.display = 'none';
            searchResultsView.style.display = 'block';
        }

        function displayMovies(movieArray, gridElement) {
            gridElement.innerHTML = '';
            if (movieArray.length === 0) {
                gridElement.innerHTML = `<p>No movies found.</p>`;
                return;
            }
            movieArray.forEach(movie => {
                const link = document.createElement('a');
                link.href = `player.html?id=${movie.id}`;
                link.innerHTML = `<div class="movie-card"><img src="${movie.poster}" alt="${movie.title}"><div class="movie-info"><h3>${movie.title}</h3></div></div>`;
                gridElement.appendChild(link);
            });
        }
        
        const categories = [ { value: 'all', text: 'All Categories' }, { value: 'trending', text: 'Trending' }, { value: 'webseries', text: 'Webseries' }, { value: 'bollywood', text: 'Bollywood' }, { value: 'hollywood', text: 'Hollywood' }, { value: 'tollywood', text: 'Tollywood' } ];
        sideMenu.innerHTML = '';
        categories.forEach(cat => {
            const item = document.createElement('a');
            item.className = 'category-item';
            item.href = `index.html?category=${cat.value}`;
            item.textContent = cat.text;
            sideMenu.appendChild(item);
        });

        // --- PAGE LOAD LOGIC ---
        fetch('movies.json')
            .then(response => response.json())
            .then(movies => {
                allMovies = movies;
                
                const urlParams = new URLSearchParams(window.location.search);
                const movieId = urlParams.get('id');

                if (!movieId) { document.querySelector('main.container').innerHTML = `<h1>Error: Movie ID not found.</h1>`; return; }
                const currentMovie = movies.find(m => m.id == movieId);
                if (!currentMovie) { document.querySelector('main.container').innerHTML = `<h1>Error: Movie not found.</h1>`; return; }

                document.title = `Download: ${currentMovie.title}`;
                document.getElementById('main-poster').src = currentMovie.poster;
                document.getElementById('main-poster').alt = currentMovie.title;
                document.getElementById('movie-title').textContent = currentMovie.title;
                document.getElementById('movie-description').textContent = currentMovie.details || '';

                const castContainer = document.getElementById('cast-list');
                const castTitle = document.getElementById('cast-title');
                castContainer.innerHTML = '';
                if (currentMovie.cast && currentMovie.cast.length > 0) {
                    castTitle.style.display = 'block';
                    currentMovie.cast.forEach(actor => {
                        const castElement = document.createElement('span');
                        castElement.className = 'cast-member';
                        castElement.textContent = actor;
                        castContainer.appendChild(castElement);
                    });
                } else {
                    castTitle.style.display = 'none';
                }

                // =======================================================================
                // === YAHAN SE CODE UPDATE KIYA GAYA HAI (Final Version) ===
                // =======================================================================

                const downloadsContainer = document.getElementById('download-links');
                downloadsContainer.innerHTML = '';
                const qualitiesToShow = ["480p", "720p", "1080p"];

                if (currentMovie.downloadLinks && Array.isArray(currentMovie.downloadLinks)) {
                    qualitiesToShow.forEach(qualityValue => {
                        const linkObject = currentMovie.downloadLinks.find(item => item.quality === qualityValue);
                        
                        const button = document.createElement('a');
                        button.className = 'download-btn';
                        
                        let buttonText = qualityValue; 
                        if (linkObject && linkObject.size) {
                            buttonText += ` (${linkObject.size})`;
                        }

                        // Condition: Kya link asli hai ya demo/missing hai?
                        if (linkObject && linkObject.link && !linkObject.link.includes('your-server.com')) {
                            // Asli link - download karega
                            button.href = linkObject.link;
                            button.setAttribute('download', '');
                        } else {
                            // Demo ya missing link - popup dikhayega
                            button.href = '#';
                            button.addEventListener('click', (e) => {
                                e.preventDefault();
                                showCustomPopup(`Sorry, the ${qualityValue} download link is not available yet!`);
                            });
                        }
                        
                        button.innerHTML = `<svg viewBox="0 0 24 24"><path d="M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z"/></svg> ${buttonText}`;
                        downloadsContainer.appendChild(button);
                    });
                } else {
                    downloadsContainer.innerHTML = '<p>Download links are not available for this title.</p>';
                }
                
                // =======================================================================
                // === CODE UPDATE ENDS HERE ===
                // =======================================================================


                // Related movies
                let relatedMovies = [];
                if (currentMovie.suggestedIds && currentMovie.suggestedIds.length > 0) {
                    relatedMovies = currentMovie.suggestedIds.map(id => movies.find(m => m.id == id)).filter(movie => movie != null);
                } else {
                    const firstCategory = Array.isArray(currentMovie.category) ? currentMovie.category[0] : currentMovie.category;
                    relatedMovies = movies.filter(m => m.id != currentMovie.id && (Array.isArray(m.category) ? m.category.includes(firstCategory) : m.category === firstCategory));
                }
                const relatedGrid = document.getElementById('related-movies-grid');
                displayMovies(relatedMovies.slice(0, 12), relatedGrid);
            })
            .catch(error => {
                console.error('Error:', error);
                document.querySelector('main.container').innerHTML = `<h2 style="color: red;">Error loading movie data.</h2>`;
            });
    });
    </script>
</body>
</html>
